<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Galaxy Shader Examples - 3x3 Grid</title>
    <style>
        html,
        body {
            height: 100vh;
            margin: 0;
            background: #0b0b0f;
            color: #eaeaf0;
            font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, Helvetica Neue, Arial, "Apple Color Emoji", "Segoe UI Emoji";
            overflow: hidden;
        }

        #app {
            position: relative;
            width: 100vw;
            height: 100vh;
        }

        #galaxy-canvas {
            width: 100%;
            height: 100%;
            display: block;
        }

        .controls {
            position: absolute;
            top: 20px;
            left: 20px;
            z-index: 100;
            background: rgba(0, 0, 0, 0.8);
            padding: 15px;
            border-radius: 8px;
            color: white;
            font-size: 14px;
            max-width: 300px;
        }

        .controls h3 {
            margin: 0 0 10px 0;
            font-size: 16px;
        }

        .controls p {
            margin: 5px 0;
            font-size: 12px;
            opacity: 0.8;
        }
    </style>
</head>

<body>
    <div id="app">
        <canvas id="galaxy-canvas"></canvas>
        <div class="controls">
            <h3>Galaxy Grid View</h3>
            <p>9 different galaxies in a 3×3 arrangement</p>
            <p>Top-down view showing spiral structures</p>
            <p>Use mouse to orbit • Scroll to zoom</p>
        </div>
    </div>

    <script type="importmap">
    			{
    				"imports": {
    					"three": "https://cdn.jsdelivr.net/npm/three@0.128.0/build/three.module.js",
    					"three/addons/": "https://cdn.jsdelivr.net/npm/three@0.128.0/examples/jsm/",
    					"galaxy-shader": "../dist/esm/GalaxyShader.js",
    					"galaxy-geometry": "../dist/esm/GalaxyGeometry.js"
    				}
    			}
    		</script>



    <script type="module">
        import * as THREE from 'three';
        import { OrbitControls } from 'three/addons/controls/OrbitControls.js';
        import { UnrealBloomPass } from 'three/addons/postprocessing/UnrealBloomPass.js';
        import { EffectComposer } from 'three/addons/postprocessing/EffectComposer.js';
        import { RenderPass } from 'three/addons/postprocessing/RenderPass.js';
        import { GalaxyShader } from 'galaxy-shader';
        import { GalaxyGeometry } from 'galaxy-geometry';

        const galaxyConfigs = [
            { // Classic Mixed Stars (Default color array)
                spiralCount: 3,
                turnsPerSpiral: 1.0,
                totalStars: 20000,
                pointSize: 2.0,
                blackHoleRadius: 0.1,
                colorMode: 0, // Fixed array cycling
                colorIntensity: 1.0
            },
            { // Radial Gradient (Hot core to cool edge)
                spiralCount: 5,
                turnsPerSpiral: 1.2,
                totalStars: 35000,
                pointSize: 1.5,
                blackHoleRadius: 0.08,
                colorMode: 1, // Gradient by radius
                colorPalette: [
                    new THREE.Color(1.0, 1.0, 0.8),  // Hot white core
                    new THREE.Color(1.0, 0.8, 0.6),  // Warm yellow
                    new THREE.Color(0.8, 0.6, 1.0),  // Cool blue
                    new THREE.Color(0.4, 0.5, 0.8)   // Cold blue edge
                ],
                colorIntensity: 1.2
            },
            { // Blue Giant Palette
                spiralCount: 2,
                turnsPerSpiral: 2.5,
                totalStars: 15000,
                pointSize: 2.5,
                blackHoleRadius: 0.15,
                colorMode: 0, // Fixed array
                colorPalette: [
                    new THREE.Color(0.7, 0.8, 1.0),   // Blue
                    new THREE.Color(0.8, 0.9, 1.0),   // Light blue
                    new THREE.Color(0.9, 0.95, 1.0),  // White-blue
                    new THREE.Color(1.0, 1.0, 1.0)    // Pure white
                ],
                colorIntensity: 1.1
            },
            { // Large Black Hole Galaxy
                spiralCount: 4,
                turnsPerSpiral: 0.8,
                totalStars: 25000,
                pointSize: 2.0,
                blackHoleRadius: 0.3,
                colorMode: 1, // Radial gradient
                colorPalette: [
                    new THREE.Color(1.0, 1.0, 1.0),   // Bright white center
                    new THREE.Color(1.0, 0.9, 0.7),   // Warm white
                    new THREE.Color(0.9, 0.7, 0.5),   // Orange
                    new THREE.Color(0.7, 0.5, 0.3)    // Dark orange edge
                ],
                colorIntensity: 1.0
            },
            { // Single Color Galaxy
                spiralCount: 3,
                turnsPerSpiral: 1.0,
                totalStars: 40000,
                pointSize: 1.0,
                blackHoleRadius: 0.12,
                colorMode: 2, // Single color
                color: new THREE.Color(1.0, 0.8, 0.6), // Warm orange
                colorIntensity: 1.0
            },
            { // Dense Green Galaxy
                spiralCount: 6,
                turnsPerSpiral: 1.5,
                totalStars: 32000,
                pointSize: 1.8,
                blackHoleRadius: 0.1,
                colorMode: 2, // Single color
                color: new THREE.Color(0.6, 1.0, 0.8), // Soft green
                colorIntensity: 1.1
            },
            { // Red Giant Galaxy
                spiralCount: 2,
                turnsPerSpiral: 0.6,
                totalStars: 8000,
                pointSize: 3.0,
                blackHoleRadius: 0.2,
                colorMode: 0, // Fixed array
                colorPalette: [
                    new THREE.Color(1.0, 0.6, 0.4),   // Orange-red
                    new THREE.Color(1.0, 0.7, 0.5),   // Orange
                    new THREE.Color(1.0, 0.8, 0.6),   // Light orange
                    new THREE.Color(1.0, 0.9, 0.7)    // Pale yellow
                ],
                colorIntensity: 1.0
            },
            { // Purple-Blue Galaxy
                spiralCount: 5,
                turnsPerSpiral: 1.0,
                totalStars: 28000,
                pointSize: 2.0,
                blackHoleRadius: 0.08,
                colorMode: 0, // Fixed array
                colorPalette: [
                    new THREE.Color(0.8, 0.4, 1.0),   // Purple
                    new THREE.Color(0.6, 0.6, 1.0),   // Blue-purple
                    new THREE.Color(0.4, 0.8, 1.0),   // Light blue
                    new THREE.Color(0.8, 0.9, 1.0)    // Very light blue
                ],
                colorIntensity: 1.2
            },
            { // Nebula Colors (Radial gradient)
                spiralCount: 4,
                turnsPerSpiral: 0.8,
                totalStars: 12000,
                pointSize: 2.8,
                blackHoleRadius: 0.25,
                colorMode: 1, // Gradient by radius
                colorPalette: [
                    new THREE.Color(1.0, 0.9, 0.8),   // Warm center
                    new THREE.Color(1.0, 0.6, 0.8),   // Pink
                    new THREE.Color(0.6, 0.4, 1.0),   // Purple
                    new THREE.Color(0.2, 0.3, 0.8)    // Deep blue edge
                ],
                colorIntensity: 1.1
            }
        ];

        function createGalaxyGrid() {
            const canvas = document.getElementById('galaxy-canvas');
            const width = window.innerWidth;
            const height = window.innerHeight;

            // Three.js setup
            const scene = new THREE.Scene();
            const camera = new THREE.PerspectiveCamera(60, width / height, 0.1, 1000);
            const renderer = new THREE.WebGLRenderer({
                canvas: canvas,
                antialias: true,
                alpha: false,
                powerPreference: 'high-performance',
            });

            renderer.setSize(width, height, false);
            renderer.setPixelRatio(Math.max(1, Math.min(2, window.devicePixelRatio || 1)));
            renderer.setClearColor(0x0b0b0f, 1.0);

            // Add post-processing
            const composer = new EffectComposer(renderer);
            const renderPass = new RenderPass(scene, camera);
            composer.addPass(renderPass);

            const bloomPass = new UnrealBloomPass(
                new THREE.Vector2(width, height),
                1.2,    // strength
                0.6,    // radius
                0.85    // threshold
            );
            composer.addPass(bloomPass);

            // Add OrbitControls
            const controls = new OrbitControls(camera, renderer.domElement);
            controls.enableDamping = true;
            controls.dampingFactor = 0.05;
            controls.screenSpacePanning = false;
            controls.minDistance = 2;
            controls.maxDistance = 50;

            // Position camera to view all galaxies from above
            camera.position.set(0, 12, 0);
            controls.target.set(0, 0, 0);

            // Create 3x3 grid of galaxies
            const galaxySpacing = 3; // Distance between galaxy centers (reduced from 4)
            const galaxyScale = 0.8; // Scale down each galaxy
            const galaxies = [];
            const shaderMaterials = [];

            // Galaxy names for labels
            const galaxyNames = [
                'Classic Mixed', 'Radial Gradient', 'Blue Giant',
                'Large Black Hole', 'Single Orange', 'Single Green',
                'Red Giant', 'Purple-Blue', 'Nebula Colors'
            ];

            for (let i = 0; i < 9; i++) {
                const config = galaxyConfigs[i];
                const row = Math.floor(i / 3);
                const col = i % 3;

                // Calculate position in 3x3 grid
                const x = (col - 1) * galaxySpacing;
                const z = (row - 1) * galaxySpacing;
                const y = 0;

                // Create galaxy group
                const galaxyGroup = new THREE.Group();
                galaxyGroup.position.set(x, y, z);
                galaxyGroup.scale.setScalar(galaxyScale);

                // Rotate galaxy to lie flat on the XZ plane (90 degrees around X axis)
                galaxyGroup.rotation.x = Math.PI / 2;

                // Create galaxy geometry and material
                const geometry = new GalaxyGeometry(config.totalStars);
                const shaderMaterial = new GalaxyShader({
                    resolution: new THREE.Vector2(width, height),
                    color: config.color,
                    pointSize: config.pointSize * 1.5, // Compensate for scaling
                    totalStars: config.totalStars,
                    time: 0,
                    blackHoleRadius: config.blackHoleRadius,
                    blackHolePosition: new THREE.Vector3(0, 0.0, 0.0),
                    spiralCount: config.spiralCount,
                    turnsPerSpiral: config.turnsPerSpiral,
                    colorMode: config.colorMode,
                    colorPalette: config.colorPalette,
                    colorIntensity: config.colorIntensity,
                    fadeNear: 5.0,
                    fadeFar: 100.0,
                });

                const points = new THREE.Points(geometry, shaderMaterial);

                // Disable frustum culling to prevent galaxies from disappearing when center goes out of view
                points.frustumCulled = false;

                galaxyGroup.add(points);

                // Add black hole visualization
                const blackHoleGeometry = new THREE.SphereGeometry(config.blackHoleRadius, 16, 16);
                const blackHoleMaterial = new THREE.MeshBasicMaterial({ color: 0x000000 });
                const blackHole = new THREE.Mesh(blackHoleGeometry, blackHoleMaterial);
                galaxyGroup.add(blackHole);

                // Create text label
                const canvas2d = document.createElement('canvas');
                const context = canvas2d.getContext('2d');
                canvas2d.width = 512;
                canvas2d.height = 128;

                context.fillStyle = 'rgba(0, 0, 0, 0.8)';
                context.fillRect(0, 0, canvas2d.width, canvas2d.height);

                context.font = '32px Arial';
                context.fillStyle = 'white';
                context.textAlign = 'center';
                context.fillText(galaxyNames[i], canvas2d.width / 2, canvas2d.height / 2 + 10);

                const texture = new THREE.CanvasTexture(canvas2d);
                const labelMaterial = new THREE.SpriteMaterial({ map: texture });
                const label = new THREE.Sprite(labelMaterial);
                label.position.set(1.8, 0, 0); // Position to the right of each galaxy
                label.scale.set(1.5, 0.375, 1); // Slightly smaller labels
                galaxyGroup.add(label);

                scene.add(galaxyGroup);
                galaxies.push(galaxyGroup);
                shaderMaterials.push(shaderMaterial);
            }

            // Handle window resize
            function handleResize() {
                const newWidth = window.innerWidth;
                const newHeight = window.innerHeight;

                camera.aspect = newWidth / newHeight;
                camera.updateProjectionMatrix();

                renderer.setSize(newWidth, newHeight, false);
                composer.setSize(newWidth, newHeight);

                // Update resolution uniforms
                shaderMaterials.forEach(material => {
                    material.uniforms.u_resolution.value.set(newWidth, newHeight);
                });
            }

            window.addEventListener('resize', handleResize);

            // Animation loop
            function animate() {
                requestAnimationFrame(animate);

                const time = performance.now() / 10000 / 5;

                // Update time for all galaxies
                shaderMaterials.forEach((material, index) => {
                    const timeScale = galaxyConfigs[index].timeScale || 1.0;
                    material.uniforms.u_time.value = time * timeScale;
                });

                controls.update();
                composer.render();
            }

            animate();
        }

        // Initialize when page loads
        setTimeout(() => {
            createGalaxyGrid();
        }, 1000);
    </script>
</body>

</html>
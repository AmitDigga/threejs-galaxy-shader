<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>3GSC - Three.js Points with ShaderMaterial</title>
    <style>
        html,
        body {
            height: 100%;
            margin: 0;
            background: #333;
            color: #eaeaf0;
            font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, Helvetica Neue, Arial, "Apple Color Emoji", "Segoe UI Emoji";
        }

        #app {
            height: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        #canvas {
            width: 1200px;
            height: 1200px;
            display: block;
            border-radius: 4px;
        }


        a {
            color: #9ab4ff;
            text-decoration: none;
        }

        a:hover {
            text-decoration: underline;
        }
    </style>
</head>

<body>
    <div id="app">
        <canvas width="1200" height="1200" id="canvas"></canvas>
    </div>

    <script type="importmap">
    			{
    				"imports": {
    					"three": "https://cdn.jsdelivr.net/npm/three@0.128.0/build/three.module.js",
    					"three/addons/": "https://cdn.jsdelivr.net/npm/three@0.128.0/examples/jsm/",
    					"galaxy-shader": "../dist/esm/GalaxyShader.js",
    					"galaxy-geometry": "../dist/esm/GalaxyGeometry.js"
    				}
    			}
    		</script>



    <script type="module">
        import * as THREE from 'three';
        import { OrbitControls } from 'three/addons/controls/OrbitControls.js';
        import { UnrealBloomPass } from 'three/addons/postprocessing/UnrealBloomPass.js';
        import { EffectComposer } from 'three/addons/postprocessing/EffectComposer.js';
        import { RenderPass } from 'three/addons/postprocessing/RenderPass.js';
        import { GalaxyShader } from 'galaxy-shader';
        import { GalaxyGeometry } from 'galaxy-geometry';
        const CANVAS_WIDTH = 1200;
        const CANVAS_HEIGHT = 1200;
        function a() {
            const canvas = document.getElementById('canvas');

            const NUM_POINTS = 30000;
            const BLACK_HOLE_RADIUS = 0.1;
            // Three.js setup
            const scene = new THREE.Scene();
            const camera = new THREE.PerspectiveCamera(75, CANVAS_WIDTH / CANVAS_HEIGHT, 0.1, 1000);
            const renderer = new THREE.WebGLRenderer({
                canvas: canvas,
                antialias: false,
                alpha: false,
                powerPreference: 'high-performance',
            });

            renderer.setSize(CANVAS_WIDTH, CANVAS_HEIGHT);
            renderer.setPixelRatio(Math.max(1, Math.min(2, window.devicePixelRatio || 1)));
            renderer.setClearColor(0x0b0b0f, 1.0);

            // Add post-processing
            const composer = new EffectComposer(renderer);
            const renderPass = new RenderPass(scene, camera);
            composer.addPass(renderPass);

            const bloomPass = new UnrealBloomPass(
                new THREE.Vector2(CANVAS_WIDTH, CANVAS_HEIGHT),
                2.5,    // strength
                1,    // radius
                0.9    // threshold
            );
            composer.addPass(bloomPass);


            // Add OrbitControls
            const controls = new OrbitControls(camera, renderer.domElement);
            controls.enableDamping = true; // Smooth camera movements
            controls.dampingFactor = 0.05;
            controls.screenSpacePanning = false;
            controls.minDistance = 0.5;
            controls.maxDistance = 10;
            camera.position.set(0, -1, .4);



            const geometry = new GalaxyGeometry(NUM_POINTS);
            const shaderMaterial = new GalaxyShader({
                resolution: new THREE.Vector2(window.innerWidth, window.innerHeight),
                color: new THREE.Color(0.92, 0.94, 1.0),
                pointSize: 2.0,
                totalStars: NUM_POINTS,
                time: 0, // Add time uniform for potential animations
                blackHoleRadius: BLACK_HOLE_RADIUS, // Radius of the black hole
                blackHolePosition: new THREE.Vector3(0, 0.0, 0.0) // Position of the black hole
            });

            // Create Points object and add to scene
            const points = new THREE.Points(geometry, shaderMaterial);
            scene.add(points);
            const blackHoleGeometry = new THREE.SphereGeometry(BLACK_HOLE_RADIUS, 32, 32);
            const blackHoleMaterial = new THREE.MeshBasicMaterial({ color: 0x000000 });
            const blackHole = new THREE.Mesh(blackHoleGeometry, blackHoleMaterial);
            scene.add(blackHole);

            // Animation loop
            function animate() {
                requestAnimationFrame(animate);
                const time = performance.now() / 10000 / 5; // Get time in seconds
                shaderMaterial.uniforms.u_time.value = time; // Update time uniform
                controls.update();
                composer.render();
            }

            animate();
        }
        setTimeout(() => {
            a();
        }, 3000); // Show error after 5 seconds if Three.js is not loaded
    </script>
</body>

</html>